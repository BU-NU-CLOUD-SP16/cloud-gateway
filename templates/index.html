<!-- ToDo  -->
<!-- 1. Add refresh button to Dnat and PortFwd  -->
<!-- 2. Add enable internet cnnection button  -->

<!DOCTYPE html>
<html>
<head>
    <title>Cloud Gateway</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

    <script src="https://code.jquery.com/jquery-2.2.3.min.js"   integrity="sha256a23g1Nt4dtEYOj7bR+vTu7+T8VP13humZFBJNIYoEJo="   crossorigin="anonymous"></script>

    <script type="text/javascript">
	 
      $(document).ready(function() {
	$('.dnats-add').on('click', function(event) {
            
            $row = $(this).closest('tr').add();
            $ori_ip = $row.find("td:nth-child(1)").children("input").val();
            $real_ip = $row.find("td:nth-child(2)").children("input").val();
	    var len = $('#dnats').length;
	    $('#dnats tbody:last').prepend('<tr><td>'+ $ori_ip +'</td><td>'+ $real_ip +'</td><td><button class="btn btn-danger btn-sm dnats-delete"><span class="glyphicon glyphicon-trash"></span></button></td> /tr>')  
            $.ajax({
                 type: "POST",
		 url: "/dnat",
                 data: {ori_ip:$ori_ip, real_ip:$real_ip}
            });
        });
	

	// Delete button for dnats
        $('.dnats-delete').on('click', function(event) {
            
            $row = $(this).closest('tr').remove();
            $ori_ip = $row.find("td:nth-child(1)").text();
            $real_ip = $row.find("td:nth-child(2)").text();
            $.ajax({
                 type: "DELETE",
                 url: "/dnat",
		 data: {ori_ip:$ori_ip, real_ip:$real_ip}
            });  
        });

        // Delete button for dnats
        $('.port-fwds-delete').on('click', function(event) {
            $row = $(this).closest('tr').remove();
            $dport = $row.find("td:nth-child(1)").text();
            $dst = $row.find("td:nth-child(2)").text();
            $.ajax({
                 type: "DELETE",
                 url: "/port_fwd",
                 data: {dport:$dport, dst:$dst}
            });  
        });

      });      

    </script>
</head>
<body>
    <div class="container">
        <h2><span class="glyphicon glyphicon-cloud"></span> Cloud Gateway <label class="label label-info">iptables</label></h2>
        <div class="row">
            <div class="col-md-6 col-lg-6">
                <h3><span class="glyphicon glyphicon-list-alt"></span> Destination NATs</h3>    
                <div class="table-responsive">
                    <table id="dnats" class="table table-striped table-bordered table-condensed">
                            <thead>
                               <tr> 
                                   <!-- <th>#</th>  -->
                                   <th>Original Ip Address</th> 
                                   <th>Real Ip Address</th> 
                                   <th><center><span class="glyphicon glyphicon-cog"></span></center></th> 
                               </tr> 
                            </thead>

                            <tbody>
                               {% for row in dnats %} 
                               <tr> 
                                <!-- <td>{{ row.index }}</td>  -->
                                <td>{{ row[0] }}</td> 
                                <td>{{ row[1] }}</td>
                                <td>
                                  <button class="btn btn-danger btn-sm dnats-delete">
                                    <span class="glyphicon glyphicon-trash"></span>
                                  </button>
                                </td>  
                               </tr>
                               {% endfor %}               

                               <tr> 
                                   <!-- <td>2</td> -->
                                    <!--form action="/dnat" method="POST"-->
                                       <td><input type="text" value="ori_ip" name="ori_ip" class="form-control" placeholder="0.0.0.0"></input></td> 
                                       <td><input type="text" value="real_ip" name="real_ip" class="form-control" placeholder="0.0.0.0"></input></td> 
                                       <td><button class="btn btn-success btn-sm dnats-add" type="submit"><span class="glyphicon glyphicon-plus"></span></button></td> 
                                    <!--/form--> 
                               </tr>         
                            </tbody>
                    </table>
                </div>
            </div>
            <div id="port_fwds" class="col-md-6 col-lg-6">
                <h3><span class="glyphicon glyphicon-list-alt"></span> Port Forwarding</h3>    
                <div class="table-responsive">
                    <table class="table table-striped table-bordered table-condensed">
                            <thead>
                               <tr> 
                                   <!-- <th>#</th>  -->
                                   <th>Destination Port</th> 
                                   <th>Dedicated Server Ip</th> 
                                   <th><center><span class="glyphicon glyphicon-cog"></span></center></th> 
                               </tr> 
                            </thead>
                            <tbody>
                               {% for row in port_fwds %} 
                               <tr> 
                                   <!-- <td>{{ row.index }}</td>  -->
                                   <td>{{ row[0] }}</td> 
                                   <td>{{ row[1] }}</td>
                                   <td><button class="btn btn-danger btn-sm port-fwds-delete"><span class="glyphicon glyphicon-trash"></span></button></td>  
                               </tr>
                               {% endfor %}               
                               <tr> 
                                   <!-- <td>2</td> -->
                                    <form action="/port_fwd" method="POST">
                                       <th><input type="text" value="dport" name="dport" class="form-control" placeholder="80"></input></th> 
                                       <th><input type="text" value="dst" name="dst" class="form-control" placeholder="0.0.0.0"></input></th> 
                                       <th><button class="btn btn-success btn-sm" type="submit"><span class="glyphicon glyphicon-plus"></span></button></th> 
                                    </form> 
                               </tr>         
                            </tbody>
                    </table>
            </div>
        </div>
    </div>
</body>

</html>
